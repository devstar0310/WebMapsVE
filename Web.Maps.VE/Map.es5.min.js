"use strict";function Simplovation$Web$Maps$JSONEncodeString(n){var t=n,i=function(n,t,i){for(var r=n;r.indexOf(t)!=-1;)r=r.replace(t,i);return r};return t=i(t,"<","\\u003c"),t=i(t,">","\\u003e"),i(t,"&","\\u0026")}Type.registerNamespace("Simplovation.Web.Maps.VE");Simplovation.Web.Maps.VE.Map=function(n){function t(n,t){return Function.createDelegate(n,t)}Simplovation.Web.Maps.VE.Map.initializeBase(this,[n]);this._Map=null;this._MainMapDiv=null;this._LatLong=null;this._Zoom="4";this._MapType=Microsoft.Maps.MapTypeId.road;this._Fixed=!1;this._ShowPoweredBy=!0;this._ShowSwitch=!0;this._NavigationBarMode=null;this._TileBuffer=0;this._Layers=null;this._AsyncPostbackPassShapes=!0;this._AppPathRoot=null;this._AppPathDomain=null;this._OnClientMapLoaded=null;this._FindArgs=null;this._BingKey=null;this._EnableBirdseye=!0;this._EnableDashboardLabels=!0;this._LoadBaseTiles=!0;this._ImportShapeLayerData_shapeSource=null;this._ImportShapeLayerData_setBestView=null;this._OnMapLoaded_Handled=!1;this._changeMapTypeHandler=t(this,this._onChangeMapType);this._OnChangeMapType_Handled=null;this._changeViewHandler=t(this,this._onChangeView);this._OnChangeView_Handled=null;this._endZoomHandler=t(this,this._onEndZoom);this._OnEndZoom_Handled=null;this._errorHandler=t(this,this._onError);this._OnError_Handled=null;this._obliqueChangeHandler=t(this,this._onObliqueChange);this._obliqueEnterHandler=t(this,this._onObliqueEnter);this._OnObliqueEnter_Handled=null;this._obliqueLeaveHandler=t(this,this._onObliqueLeave);this._OnObliqueLeave_Handled=null;this._startZoomHandler=t(this,this._onStartZoom);this._clickHandler=t(this,this._click);this._click_Handled=null;this._onDoubleClickHandler=t(this,this._onDoubleClick);this._onMouseDownHandler=t(this,this._onMouseDown);this._onMouseMoveHandler=t(this,this._onMouseMove);this._onMouseOutHandler=t(this,this._onMouseOut);this._onMouseOverHandler=t(this,this._onMouseOver);this._onMouseUpHandler=t(this,this._onMouseUp);this._onMouseWheelHandler=t(this,this._onMouseWheel);this._onKeyPressHandler=t(this,this._onKeyPress);this._onKeyDownHandler=t(this,this._onKeyDown);this._onKeyUpHandler=t(this,this._onKeyUp);this._map_OnLoad$delegate=t(this,this._map_OnLoad)};Simplovation.Web.Maps.VE.Map.prototype={initialize:function(){var n,t;Simplovation.Web.Maps.VE.Map.callBaseMethod(this,"initialize");n=this;isNaN(this._MapType)||(this._MapType=this._MapType==2?Microsoft.Maps.MapTypeId.aerial:this._MapType==3?Microsoft.Maps.MapTypeId.hybrid:this._MapType==4?Microsoft.Maps.MapTypeId.oblique:this._MapType==5?Microsoft.Maps.MapTypeId.shaded:Microsoft.Maps.MapTypeId.road);isNaN(this._NavigationBarMode)||(this._NavigationBarMode=this._NavigationBarMode==2?Microsoft.Maps.NavigationBarMode.compact:Microsoft.Maps.NavigationBarMode.compact);this._MainMapDiv=$get(this.get_id()+"_Map");t={credentials:this._BingKey||"not set",zoom:this._Zoom,disablePanning:this._Fixed,disableZooming:this._Fixed};this._NavigationBarMode!==null&&(t.navigationBarMode=this._NavigationBarMode);window.setTimeout(function(){n._Map=new Microsoft.Maps.Map(n._MainMapDiv,t)},100)},dispose:function(){this._Map&&this._Map.Dispose&&this._Map.Dispose();Simplovation.Web.Maps.VE.Map.callBaseMethod(this,"dispose")},_map_OnLoad:function(n){var i=this,r,t;this._DistanceUnit!=null&&(this._DistanceUnit=this._DistanceUnit==1?VEDistanceUnit.Kilometers:VEDistanceUnit.Miles,this._Map.SetScaleBarDistanceUnit(this._DistanceUnit));this._Layers&&this._Layers.length>0&&this._loadShapeLayersFromCollection(this._Layers);this.get_OnMapLoaded_Handled()&&this._triggerAsyncPostback("maploaded");this._OnClientMapLoaded&&(r=Function.createDelegate(this,eval(this._OnClientMapLoaded)),r(this,n));this._FindArgs&&this._doFindFromFindArgs(this._FindArgs);this._ImportShapeLayerData_shapeSource&&this._doImportShapeLayerData(this._ImportShapeLayerData_shapeSource,this._ImportShapeLayerData_setBestView);this._ShowPoweredBy&&(t=this.logo=document.createElement("span"),t.id=this.get_id()+"_Logo",t.style.border="solid 1px #555",t.style.background="#fff",t.style.padding="2px",t.style.top="100px",t.innerHTML="<span style='font-size:8px;white-space:nowrap;'>powered by<br/><\/span><span style='font-size:15px;'><a href='http://webmapsve.codeplex.com' target='_blank' style='text-decoration:none;cursor:pointer'>Web.Maps.VE<\/a><\/span>",window.setTimeout(function(){i.get_Map().AddControl(t);i._realignLogo()},100))},_realignLogo:function(){if(this._ShowPoweredBy){var n=this.logo;n&&(n.style.top=this.get_element().offsetHeight-n.offsetHeight-50+"px",n.style.left="10px",this.get_Map().AddControl(n))}},_loadShapeLayersFromCollection:function(n){for(var e,u,r,t=null,f=!1,o=n.length,i=0;i<o;i++){for(t=this.get_Map().GetShapeLayerByIndex(i),f=t==null,f&&(t=new VEShapeLayer),t.SetTitle(n[i].Title),t.SetDescription(n[i].Description),n[i].Visible?t.Show():t.Hide(),t.SimplovationTag=n[i].Tag,e=n[i].Shapes.length,u=0;u<e;u++)r=n[i].Shapes[u],r.ClientID==null?(console.error("adding NewShapes not supported yet"),r=this._getVEShape(r),t.AddShape(r)):(console.error("update ExistingShape not supported yet"),this._updateVEShape(r));f&&this.get_Map().AddShapeLayer(t)}},_getVEShape:function(n){var i,u,t,r;for(n.Type=n.Type==1?VEShapeType.Polyline:n.Type==2?VEShapeType.Polygon:VEShapeType.Pushpin,i=[],u=n.Points.length,t=0;t<u;t++)i.push(this._getVELatLong(n.Points[t]));return r=new VEShape(n.Type,i),this._setVEShapeProperties(n,r),r},_getVELatLong:function(n){return new Microsoft.Maps.Location(n.Latitude,n.Longitude)},_getVEShapeSourceSpecification:function(n){return new VEShapeSourceSpecification(this._getVEDataType(n.Type),n.LayerSource,null)},_getVEDataType:function(n){return n==0?VEDataType.GeoRSS:n==1?VEDataType.VECollection:n==2?VEDataType.ImportXML:n},_getIntFromVEDataType:function(n){return n==VEDataType.GeoRSS?0:n==VEDataType.VECollection?1:n==VEDataType.ImportXML?2:n},_updateVEShape:function(n){var t=this.get_Map().GetShapeByID(n.ClientID);t==null||(n.Type=n.Type==1?VEShapeType.Polyline:n.Type==2?VEShapeType.Polygon:VEShapeType.Pushpin,this._setVEShapeProperties(n,t))},_getVEColor:function(n){return new VEColor(n.R,n.G,n.B,n.A)},_getVEPixel:function(n){return new VEPixel(n.X,n.Y)},_getVECustomIconSpecification:function(n){var t=new VECustomIconSpecification;return n.BackColor&&(t.BackColor=this._getVEColor(n.BackColor)),n.CustomHTML&&(t.CustomHTML=n.CustomHTML),n.ForeColor&&(t.ForeColor=this._getVEColor(n.ForeColor)),n.Image&&(t.Image=n.Image),n.ImageOffset&&(t.ImageOffset=this._getVEPixel(n.ImageOffset)),n.TextBold&&(t.TextBold=n.TextBold),n.TextContent&&(t.TextContent=n.TextContent),n.TextFont&&(t.TextFont=n.TextFont),n.TextItalics&&(t.TextItalics=n.TextItalics),n.TextOffset&&(t.TextOffset=this._getVEPixel(n.TextOffset)),n.TextSize&&(t.TextSize=n.TextSize),n.TextUnderline&&(t.TextUnderline=n.TextUnderline),t},_setVEShapeProperties:function(n,t){n.Altitude&&t.SetAltitude(n.Altitude,this._getVEAltitudeModeFromInt(n.AltitudeMode));n.Description&&t.SetDescription(n.Description);n.Draggable!=undefined&&(t.Draggable=n.Draggable);n.CustomIcon&&t.SetCustomIcon(this._getVECustomIconSpecification(n.CustomIcon));n.FillColor&&t.SetFillColor(this._getVEColor(n.FillColor));n.IconAnchor&&t.SetIconAnchor(new Microsoft.Maps.Location(n.IconAnchor.Latitude,n.IconAnchor.Longitude));n.LineColor&&t.SetLineColor(this._getVEColor(n.LineColor));n.Type!=VEShapeType.Pushpin&&n.LineWidth>0&&t.SetLineWidth(n.LineWidth);n.MoreInfoURL&&t.SetMoreInfoURL(Simplovation.Web.Maps.VE.Utils.UrlHelper.ToAbsolute(n.MoreInfoURL,this._AppPathRoot));n.PhotoURL&&t.SetPhotoURL(Simplovation.Web.Maps.VE.Utils.UrlHelper.ToAbsolute(n.PhotoURL,this._AppPathRoot));n.ZIndex&&t.SetZIndex(n.ZIndex);t.SetTitle(n.Title);t.SimplovationTag=n.Tag;n.ShowIcon?t.ShowIcon():t.HideIcon()},AddShape:function(n){this.get_Map().AddShape(n)},DeleteShapeById:function(n){var t=this.GetShapeByID(n);this.DeleteShape(t)},SetCenterOnShapeByID:function(n,t,i){var r=this.GetShapeByID(n);if(r==null)throw"Unable to find Shape ("+n+")";else this.SetCenterOnShape(r,t,i)},SetCenterOnShape:function(n,t){t?this.SetCenterAndZoom(n.GetIconAnchor(),t):this.SetCenter(n.GetIconAnchor())},SetCenterOnShapeByTag:function(n,t){var i=this.GetShapeByTag(n);if(i==null)throw"Unable to find Shape by Tag ("+n+")";else this.SetCenterOnShape(i,t)},GetShapeByTag:function(n){for(var r,e,t,u,f=this.get_Map(),o=f.GetShapeLayerCount(),i=0;i<o;i++)for(r=f.GetShapeLayerByIndex(i),e=r.GetShapeCount(),t=0;t<e;t++)if(u=r.GetShapeByIndex(t),u.SimplovationTag==n)return u;return null},AddControl:function(n,t){this.get_Map().AddControl(n,t)},AddCustomLayer:function(n){this.get_Map().AddCustomLayer(n)},AddShapeLayer:function(n,t){this.get_Map().AddShapeLayer(n,t)},AddTileLayer:function(n,t){this.get_Map().AddTileLayer(n,t)},Clear:function(){this.get_Map().Clear()},DeleteAllShapeLayers:function(){this.get_Map().DeleteAllShapeLayers()},DeleteAllShapes:function(){this.get_Map().DeleteAllShapes()},DeleteControl:function(n){this.get_Map().DeleteControl(n)},DeleteRoute:function(){this.get_Map().DeleteRoute()},DeleteShape:function(n){n&&(this.get_Map().DeleteShape(n),n=null)},DeleteShapeLayer:function(n){this.get_Map().DeleteShapeLayer(n)},DeleteTileLayer:function(n){this.get_Map().DeleteTileLayer(n)},EnableShapeDisplayThreshold:function(n){this.get_Map().EnableShapeDisplayThreshold(n)},Find:function(n,t,i,r,u,f,e,o,s,h,c){this.get_Map().Find(n,t,i,r,u,f,e,o,s,h,c)},FindLocations:function(n,t){this.get_Map().FindLocations(n,t)},Geocode:function(n,t,i){this.get_Map().Geocode(n,t,i)},GetBirdseyeScene:function(){return this.get_Map().GetBirdseyeScene()},GetCenter:function(){return this.get_Map().GetCenter()},GetDirections:function(n,t){this.get_Map().GetDirections(n,t)},GetHeight:function(){return this.get_Height()},GetLeft:function(){return this.get_Map().GetLeft()},GetMapType:function(){return this.get_Map().getMapTypeId()},GetMapView:function(){return null},GetShapeByID:function(n){return this.get_Map().GetShapeByID(n)},GetShapeLayerByIndex:function(n){return this.get_Map().GetShapeLayerByIndex(n)},GetShapeLayerCount:function(n){return this.get_Map().GetShapeLayerCount(n)},GetTileLayerByID:function(n){return this.get_Map().GetTileLayerByID(n)},GetTileLayerByIndex:function(n){return this.get_Map().GetTileLayerByIndex(n)},GetTileLayerCount:function(){return this.get_Map().GetTileLayerCount()},GetTop:function(){return this.get_Map().GetTop()},GetVersion:function(){return VEMap.GetVersion()},GetWidth:function(){return this.get_Width()},GetZoomLevel:function(){return this.get_Map().getZoom()},Hide3DNavigationControl:function(){this.get_Map().Hide3DNavigationControl()},HideAllShapeLayers:function(){this.get_Map().HideAllShapeLayers()},HideControl:function(n){this.get_Map().HideControl(n)},HideFindControl:function(){this.get_Map().HideFindControl()},HideInfoBox:function(){this.get_Map().HideInfoBox()},HideMiniMap:function(){this.get_Map().HideMiniMap()},HideTileLayer:function(n){this.get_Map().HideTileLayer(n)},ImportShapeLayerData:function(n,t,i){this.get_Map().ImportShapeLayerData(n,t,i)},IncludePointInView:function(n){this.get_Map().IncludePointInView(n)},IsBirdseyeAvailable:function(){return this.get_Map().IsBirdseyeAvailable()},LatLongToPixel:function(n){return this.get_Map().LatLongToPixel(n)},PixelToLatLong:function(n){return this.get_Map().PixelToLatLong(n)},RemoveCustomLayer:function(n){this.get_Map().RemoveCustomLayer(n)},Search:function(n,t,i){this.get_Map().Search(n,t,i)},SetBirdseyeScene:function(n,t,i,r){this.get_Map().SetBirdseyeScene(n,t,i,r)},SetCenter:function(n){this.get_Map().setView({center:n})},SetCenterAndZoom:function(n,t){this.get_Map().setView({center:n,zoom:t})},SetNavigationBarMode:function(n){this.get_Map().SetNavigationBarMode(n)},SetFailedShapeRequest:function(n){this.get_Map().SetFailedShapeRequest(n)},SetMapType:function(n){isNaN(n)||(n=n==2?Microsoft.Maps.MapTypeId.aerial:n==3?Microsoft.Maps.MapTypeId.hybrid:n==4?Microsoft.Maps.MapTypeId.oblique:n==5?Microsoft.Maps.MapTypeId.shaded:Microsoft.Maps.MapTypeId.road);this.get_Map().setMapType(n)},SetMapView:function(n){this.get_Map().SetMapView(n)},SetMouseWheelZoomToCenter:function(n){this.get_Map().SetMouseWheelZoomToCenter(n)},SetShapesAccuracy:function(n){this.get_Map().SetShapesAccuracy(n)},SetShapesAccuracyRequestLimit:function(n){this.get_Map().SetShapesAccuracyRequestLimit(n)},SetTileBuffer:function(n){this.get_Map().SetTileBuffer(n)},SetZoomLevel:function(n){this.get_Map().setView({zoom:n})},Show3DNavigationControl:function(){this.get_Map().Show3DNavigationControl()},ShowAllShapeLayers:function(){this.get_Map().ShowAllShapeLayers()},ShowControl:function(){this.get_Map().ShowControl()},ShowDisambiguationDialog:function(n){this.get_Map().ShowDisambiguationDialog(n)},ShowFindControl:function(){this.get_Map().ShowFindControl()},ShowInfoBox:function(n,t,i){this.get_Map().ShowInfoBox(n,t,i)},ShowMessage:function(n){this.get_Map().ShowMessage(n)},ShowMiniMap:function(n,t,i){this.get_Map().ShowMiniMap(n,t,i)},ShowTileLayer:function(n){this.get_Map().ShowTileLayer(n)},ZoomIn:function(){this.SetZoomLevel(this.GetZoomLevel()+1)},ZoomOut:function(){this.SetZoomLevel(this.GetZoomLevel()-1)},get_Map:function(){return this._Map},get_MainMapDiv:function(){return this._MainMapDiv},get_ShowPoweredBy:function(){return this._ShowPoweredBy},set_ShowPoweredBy:function(n){this._ShowPoweredBy=n},get_Width:function(){return this.get_Map().getWidth()},get_Height:function(){return this.get_Map().getHeight()},get_LatLong:function(){return this._LatLong},set_LatLong:function(n){this._LatLong=n},get_Zoom:function(){return this._Zoom},set_Zoom:function(n){this._Zoom=n},get_MapType:function(){return this._MapType},set_MapType:function(n){this._MapType=n},get_AsyncPostbackPassShapes:function(){return this._AsyncPostbackPassShapes},set_AsyncPostbackPassShapes:function(n){this._AsyncPostbackPassShapes=n},get_Fixed:function(){return this._Fixed},set_Fixed:function(n){this._Fixed=n},get_DistanceUnit:function(){return this._DistanceUnit},set_DistanceUnit:function(n){this._DistanceUnit=n},get_ShowSwitch:function(){return this._ShowSwitch},set_ShowSwitch:function(n){this._ShowSwitch=n},get_NavigationBarMode:function(){return this._NavigationBarMode},set_NavigationBarMode:function(n){this._NavigationBarMode=n},get_TileBuffer:function(){return this._TileBuffer},set_TileBuffer:function(n){this._TileBuffer=n},get_EnableBirdseye:function(){return this._EnableBirdseye},set_EnableBirdseye:function(n){this._EnableBirdseye=n},get_EnableDashboardLabels:function(){return this._EnableDashboardLabels},set_EnableDashboardLabels:function(n){this._EnableDashboardLabels=n},get_LoadBaseTiles:function(){return this._LoadBaseTiles},set_LoadBaseTiles:function(n){this._LoadBaseTiles=n},get_Layers:function(){return this_Layers},set_Layers:function(n){this._Layers=n},get_AppPathRoot:function(){return this._AppPathRoot},set_AppPathRoot:function(n){this._AppPathRoot=n},get_BingKey:function(){return this._BingKey},set_BingKey:function(n){this._BingKey=n},get_ImportShapeLayerData_shapeSource:function(){return this._ImportShapeLayerData_shapeSource},set_ImportShapeLayerData_shapeSource:function(n){this._ImportShapeLayerData_shapeSource=n},get_ImportShapeLayerData_setBestView:function(){return this._ImportShapeLayerData_setBestView},set_ImportShapeLayerData_setBestView:function(n){this._ImportShapeLayerData_setBestView=n},get_OnMapLoaded_Handled:function(){return this._OnMapLoaded_Handled},set_OnMapLoaded_Handled:function(n){this._OnMapLoaded_Handled=n},get_OnClientMapLoaded:function(){return this._OnClientMapLoaded},set_OnClientMapLoaded:function(n){this._OnClientMapLoaded=n},get_OnChangeMapType_Handled:function(){return this._OnChangeMapType_Handled},set_OnChangeMapType_Handled:function(n){this._OnChangeMapType_Handled=n},get_OnChangeView_Handled:function(){return this._OnChangeView_Handled},set_OnChangeView_Handled:function(n){this._OnChangeView_Handled=n},get_OnEndZoom_Handled:function(){return this._OnEndZoom_Handled},set_OnEndZoom_Handled:function(n){this._OnEndZoom_Handled=n},get_OnObliqueEnter_Handled:function(){return this._OnObliqueEnter_Handled},set_OnObliqueEnter_Handled:function(n){this._OnObliqueEnter_Handled=n},get_OnObliqueLeave_Handled:function(){return this._OnObliqueLeave_Handled},set_OnObliqueLeave_Handled:function(n){this._OnObliqueLeave_Handled=n},get_Click_Handled:function(){return this._click_Handled},set_Click_Handled:function(n){this._click_Handled=n},get_FindArgs:function(){return this._FindArgs},set_FindArgs:function(n){this._FindArgs=n},GetAsyncEventData:function(n){var t=new Simplovation.Web.Maps.VE.AsyncMapData,u=this._Map,i,r,f;return t.EventName=n[0],t.EventArgs=n[1],t.Width=this.get_Width(),t.Height=this.get_Height(),t.EventArgs&&(i=function(n){return n?parseInt(n):n},t.EventArgs.mapX=i(t.EventArgs.mapX),t.EventArgs.mapY=i(t.EventArgs.mapY),t.EventArgs.clientX=i(t.EventArgs.clientX),t.EventArgs.clientY=i(t.EventArgs.clientY)),t.ZoomLevel=u.getZoom(),r=u.getMapTypeId(),t.MapType=r==Microsoft.Maps.MapTypeId.aerial?2:r==Microsoft.Maps.MapTypeId.hybrid?3:r==Microsoft.Maps.MapTypeId.oblique?4:r==Microsoft.Maps.MapTypeId.shaded?5:1,function(){var n=u.getCenter();t.Latitude=n.latitude;t.Longitude=n.longitude}(),t.EventName=="maploaded"&&(t.MapLoadedEventArgs={}),t.EventName=="click"&&(f=u.PixelToLatLong(new VEPixel(t.EventArgs.mapX,t.EventArgs.mapY)),f.Latitude!=null?(t.ClickedLatitude=f.Latitude,t.ClickedLongitude=f.Longitude):t.MapView=null),Sys.Serialization.JavaScriptSerializer.serialize(t)},_triggerDirectionsLoadedAsyncPostback:function(n){var t=new Sys.StringBuilder,i,e,r,f,o,u,s;for(t.append('{"Distance":'),t.append(n.Distance),t.append(',"Time":'),t.append(n.Time),t.append(',"RouteLegs":['),e=n.RouteLegs.length,r=0;r<e;r++){for(f=n.RouteLegs[r],r>0&&t.append(","),t.append('{"Distance":'),t.append(n.RouteLegs[r].Distance),t.append(',"Itinerary":{"Items":['),o=f.Itinerary.Items.length,u=0;u<o;u++)i=f.Itinerary.Items[u],u>0&&t.append(","),t.append("{"),t.append('"Distance":'),t.append(i.Distance),t.append(',"LatLong":{"Latitude":'),t.append(i.LatLong.Latitude),t.append(',"Longitude":'),t.append(i.LatLong.Longitude),t.append("}"),t.append(',"Text":'),t.append(Sys.Serialization.JavaScriptSerializer.serialize(i.Text)),t.append(',"Time":'),t.append(i.Time),t.append("}");t.append("]}}")}t.append("]}");s=document.getElementById(this.get_id()+"_UP_HiddenDirectionsField");s.value=t.toString();this._triggerAsyncPostback("directionsloaded")},LoadAsyncEventData:function(n){var h=this,e=this.get_Map(),t=Sys.Serialization.JavaScriptSerializer.deserialize(n),o,c,s,l,r,u,i,f;if(t.MapType!=null&&this.SetMapType(t.MapType),t.DeleteLayersFirst!=null&&t.DeleteLayersFirst&&this.DeleteAllShapeLayers(),t.ShapeLayersToRemove)for(o=t.ShapeLayersToRemove.split("|"),r=o.length-1;r>=0;r--)this.DeleteShapeLayer(this.GetShapeLayerByIndex(parseInt(o[r])));if(t.ShapesToRemove)for(o=t.ShapesToRemove.split("|"),c=o.length,r=0;r<c;r++)this.DeleteShape(e.GetShapeByID(o[r]));if(t.Layers&&this._loadShapeLayersFromCollection(t.Layers),t.ZoomLevel&&t.Latitude&&t.Longitude?e.SetCenterAndZoom(new Microsoft.Maps.Location(t.Latitude,t.Longitude),t.ZoomLevel):(t.ZoomLevel&&e.setView({zoom:t.ZoomLevel}),t.Latitude&&t.Longitude&&e.setView({center:new Microsoft.Maps.Location(t.Latitude,t.Longitude)})),t.Directions_Clear!=null&&e.DeleteRoute(),t.Direction_Locations){for(s=[],l=t.Direction_Locations.length,r=0;r<l;r++)f=t.Direction_Locations[r],s[r]=typeof f=="string"?f:new Microsoft.Maps.Location(f.Latitude,f.Longitude);u=new VERouteOptions;u.RouteCallback=function(n){n&&h._triggerDirectionsLoadedAsyncPostback(n)};i=t.Direction_RouteOptions;i&&(i.DistanceUnit!=null&&(u.DistanceUnit=i.DistanceUnit==1?VERouteDistanceUnit.Kilometer:VERouteDistanceUnit.Mile),i.DrawRoute!=null&&(u.DrawRoute=i.DrawRoute),i.RouteColor!=null&&(u.RouteColor=this._getVEColor(i.RouteColor)),i.RouteMode!=null&&(u.RouteMode=i.RouteMode==1?VERouteMode.Walking:VERouteMode.Driving),i.RouteOptimize!=null&&(u.RouteOptimize=i.RouteOptimize==1?VERouteOptimize.MinimizeTime:i.RouteOptimize==2?VERouteOptimize.MinimizeDistance:VERouteOptimize.Default),i.RouteWeight!=null&&(u.RouteWeight=i.RouteWeight),i.RouteZIndex!=null&&(u.RouteZIndex=i.RouteZIndex),i.SetBestMapView!=null&&(u.SetBestMapView=i.SetBestMapView),i.ShowDisambiguation!=null&&(u.ShowDisambiguation=i.ShowDisambiguation),i.ShowErrorMessages!=null&&(u.ShowErrorMessages=i.ShowErrorMessages));e.GetDirections(s,u)}return t.FindArgs&&this._doFindFromFindArgs(t.FindArgs),t.FindLocations&&(f=this._getVELatLong(t.FindLocations),e.FindLocations(f,function(n){h._findLocationsCallback(f,n)})),t.ImportShapeLayerData_shapeSource&&this._doImportShapeLayerData(t.ImportShapeLayerData_shapeSource,t.ImportShapeLayerData_setBestView),null},_doImportShapeLayerData:function(n,t){var i=this;this.ImportShapeLayerData(this._getVEShapeSourceSpecification(n),function(n){i._importShapeLayerDataCallback(n)},t)},_importShapeLayerDataCallback:function(n){var t=new Simplovation.Web.Maps.VE.ImportShapeLayerDataEventArgs,i;t.ShapeLayer=this._convertShapeLayerToPostback(n);t.ShapeSource=new Simplovation.Web.Maps.VE.ShapeSourceSpecification;t.ShapeSource.LayerSource=n.Spec.LayerSource;t.ShapeSource.Type=this._getIntFromVEDataType(n.Spec.Type);i=document.getElementById(this.get_id()+"_UP_ISLDHF");i.value=Sys.Serialization.JavaScriptSerializer.serialize(t);this._triggerAsyncPostback("importshapelayerdataloaded")},_findLocationsCallback:function(n,t){var i=new Simplovation.Web.Maps.VE.FindLocationsCallbackArgs,r;i.Location=n;i.Places=t;r=document.getElementById(this.get_id()+"_UP_HiddenFLField");r.value=Sys.Serialization.JavaScriptSerializer.serialize(i);this._triggerAsyncPostback("findlocationsloaded")},_doFindFromFindArgs:function(n){var t=this;this.Find(n.What,n.Where,VEFindType.Businesses,null,n.StartIndex,n.NumberOfResults,n.ShowResults,n.CreateResults,n.UseDefaultDisambiguation,n.SetBestMapView,function(n,i,r,u,f){t._findCallback(n,i,r,u,f)})},_findCallback:function(n,t,i){var e=new Simplovation.Web.Maps.VE.FindCallbackArgs,o,s,f,u,r,h;if(e.Places=i,o=[],t)for(s=t.length,f=0;f<s;f++)u=t[f],r={},r.Name=u.Name,u.Shape==null?r.Shape==null:r.Shape=this._convertShapeToPostback(u.Shape),r.Description=u.Description,r.FindType=this._getIntFromFindType(u.FindType),r.IsSponsored=u.IsSponsored,r.LatLong=u.LatLong,r.Phone=u.Phone,o.push(r);e.Results=o;h=document.getElementById(this.get_id()+"_UP_HiddenFindField");h.value=Sys.Serialization.JavaScriptSerializer.serialize(e);this._triggerAsyncPostback("findloaded")},_getIntFromFindType:function(n){return n==VEFindType.Businesses?0:n},_raiseClientSideEvent:function(n,t){var i=this.get_events().getHandler(n);i&&i(this,t)},addHandler:function(n,t){this.get_events().addHandler(n,t)},removeHandler:function(n,t){this.get_events().removeHandler(n,t)},AddHandler:function(n,t){this.addHandler(n,t)},RemoveHandler:function(n,t){this.removeHandler(n,t)},AttachEvent:function(n,t){this.addHandler(n,t)},DetachEvent:function(n,t){this.removeHandler(n,t)},_convertShapeLayerToPostback:function(n){var i,t;for(sl=new Simplovation.Web.Maps.VE.ShapeLayer,sl.Title=n.GetTitle(),sl.Description=n.GetDescription(),sl.Visible=n.IsVisible(),sl.Tag=n.SimplovationTag,sl.Shapes=[],i=n.GetShapeCount(),t=0;t<i;t++)sl.Shapes.push(this._convertShapeToPostback(n.GetShapeByIndex(t)));return sl},_convertShapeToPostback:function(n){var f=Simplovation.Web.Maps.VE.Utils.AppPathDomain,i,t=new Simplovation.Web.Maps.VE.Shape,o,r,u,c,e,s,h;if(typeof n!="string"?(i=n,t.ClientID=i.GetID()):(t.ClientID=n,i=this._Map.GetShapeByID(t.ClientID)),t.Title=Simplovation$Web$Maps$JSONEncodeString(i.GetTitle()),t.Description=Simplovation$Web$Maps$JSONEncodeString(i.GetDescription()),t.Draggable=i.Draggable,i.GetCustomIcon()&&(t.CustomIcon=i.GetCustomIcon(),t.CustomIcon.CustomHTML=Simplovation$Web$Maps$JSONEncodeString(t.CustomIcon.CustomHTML),t.CustomIcon.Image=Simplovation$Web$Maps$JSONEncodeString(t.CustomIcon.Image),t.CustomIcon.ImageOffset=new Simplovation.Web.Maps.VE.Pixel(t.CustomIcon.ImageOffset.x,t.CustomIcon.ImageOffset.y),t.CustomIcon.TextOffset=new Simplovation.Web.Maps.VE.Pixel(t.CustomIcon.TextOffset.x,t.CustomIcon.TextOffset.y)),t.FillColor=i.GetFillColor(),t.IconAnchor=i.GetIconAnchor(),t.LineColor=i.GetLineColor(),o=i.GetLineWidth(),o&&(t.LineWidth=o),r=i.GetMoreInfoURL(),r.substring(0,f.length)==f&&(r=r.substring(f.length)),r.substring(0,this._AppPathRoot.length)==this._AppPathRoot&&(r="~/"+r.substring(this._AppPathRoot.length)),t.MoreInfoURL=r,u=i.GetPhotoURL(),u.substring(0,f.length)==f&&(u=u.substring(f.length)),u.substring(0,this._AppPathRoot.length)==this._AppPathRoot&&(u="~/"+u.substring(this._AppPathRoot.length)),t.PhotoURL=u,t.Points=i.GetPoints(),t.Points.length!=0)for(c=t.Points.length,e=0;e<c;e++)t.Points[e].AltitudeMode=this._getIntFromVEAltitudeMode(t.Points[e].AltitudeMode);return s=i.GetAltitude(),s&&(t.Altitude=s[0]),t.AltitudeMode=this._getIntFromVEAltitudeMode(i.GetAltitudeMode),h=i.GetType(),t.Type=h==VEShapeType.Pushpin?0:h==VEShapeType.Polygon?2:1,t.ZIndex=i.GetZIndex(),t.Tag=i.SimplovationTag,t},_onChangeMapType:function(n){this.get_OnChangeMapType_Handled()&&this._triggerAsyncPostback("maptypechanged",n);this._raiseClientSideEvent("maptypechanged",n)},_onChangeView:function(n){this.get_OnChangeView_Handled()&&this._triggerAsyncPostback("onchangeview",n);this._raiseClientSideEvent("onchangeview",n)},_onEndZoom:function(n){this.get_OnEndZoom_Handled()&&this._triggerAsyncPostback("onendzoom",n);this._raiseClientSideEvent("onendzoom",n)},_onError:function(n){this._triggerAsyncPostback("onerror",n);this._raiseClientSideEvent("onerror",n)},_onObliqueEnter:function(n){this.get_OnObliqueEnter_Handled()&&this._triggerAsyncPostback("onobliqueenter",n);this._raiseClientSideEvent("onobliqueenter",n)},_onObliqueLeave:function(n){this.get_OnObliqueLeave_Handled()&&this._triggerAsyncPostback("onobliqueleave",n);this._raiseClientSideEvent("onobliqueleave",n)},_onObliqueChange:function(n){this._raiseClientSideEvent("onobliquechange",n)},_onStartZoom:function(n){this._raiseClientSideEvent("onstartzoom",n)},_click:function(n){this.get_Click_Handled()&&this._triggerAsyncPostback("click",n);this._raiseClientSideEvent("click",n)},_onDoubleClick:function(n){this._raiseClientSideEvent("dblclick",n)},_onMouseDown:function(n){this._raiseClientSideEvent("mousedown",n)},_onMouseMove:function(n){this._raiseClientSideEvent("mousemove",n)},_onMouseOut:function(n){this._raiseClientSideEvent("mouseout",n)},_onMouseOver:function(n){this._raiseClientSideEvent("mouseover",n)},_onMouseUp:function(n){this._raiseClientSideEvent("mouseup",n)},_onMouseWheel:function(n){this._raiseClientSideEvent("onmousewheel",n)},_onKeyPress:function(n){this._raiseClientSideEvent("keypress",n)},_onKeyDown:function(n){this._raiseClientSideEvent("keydown",n)},_onKeyUp:function(n){this._raiseClientSideEvent("keyup",n)}};Simplovation.Web.Maps.VE.Map.registerClass("Simplovation.Web.Maps.VE.Map",Simplovation.Web.Maps.VE.AsyncScriptControl);Simplovation.Web.Maps.VE.AsyncMapData=function(){this.EventName=null;this.EventArgs=null;this.Width=null;this.Height=null;this.ZoomLevel=null;this.Latitude=null;this.Longitude=null;this.MapType=null;this.Direction_Locations=null;this.Direction_RouteOptions=null;this.MapLoadedEventArgs=null;this.ImportShapeLayerData_shapeSource=null;this.ImportShapeLayerData_setBestView=!1};Simplovation.Web.Maps.VE.FindCallbackArgs=function(){this.Places=null;this.Results=null};Simplovation.Web.Maps.VE.FindLocationsCallbackArgs=function(){this.Location=null;this.Places=null};Simplovation.Web.Maps.VE.Shape=function(){this.ClientID=null;this.CustomIcon=null;this.Description=null;this.FillColor=null;this.IconAnchor=null;this.LineColor=null;this.LineWidth=2;this.MoreInfoURL=null;this.PhotoURL=null;this.Points=null;this.Title=null;this.Type=0;this.Altitude=0;this.AltitudeMode=0};Simplovation.Web.Maps.VE.Pixel=function(n,t){this.X=isNaN(n)?0:n;this.Y=isNaN(t)?0:t};Simplovation.Web.Maps.VE.ShapeLayer=function(){this.Title=null;this.Description=null;this.Shapes=null;this.Visible=!0};Simplovation.Web.Maps.VE.ImportShapeLayerDataEventArgs=function(){this.ShapeLayer=null;this.BestMapView=null;this.ShapeSource=null};Simplovation.Web.Maps.VE.ShapeSourceSpecification=function(){this.LayerSource=null;this.Type=null};Type.registerNamespace("Simplovation.Web.Maps.VE.Utils");Simplovation.Web.Maps.VE.Utils.AppPathDomain=location.protocol+"//"+location.host;Type.registerNamespace("Simplovation.Web.Maps.VE.Utils.UrlHelper");Simplovation.Web.Maps.VE.Utils.UrlHelper.ToAbsolute=function(n,t){var i=n;return i.substring(0,2)=="~/"&&(i=t+i.substring(2)),i.substring(0,1)=="/"&&(i=Simplovation.Web.Maps.VE.Utils.AppPathDomain+i),i};Sys.Application.notifyScriptLoaded();